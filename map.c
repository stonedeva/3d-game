#include "./map.h"
#include <time.h>
#include <stdio.h>
#include <string.h>


Tile map[MAP_WIDTH][MAP_HEIGHT] = {
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,2,2,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,2,0,0,0,0,0,2,1,0,0,0,0,1,1,1,0,0,0,1},
    {1,0,0,0,0,2,0,0,0,0,0,2,0,1,0,1,1,0,0,1,1,0,0,1},
    {1,0,0,0,2,0,0,0,0,0,0,3,0,0,1,0,0,0,0,0,1,0,0,1},
    {1,0,0,0,2,0,0,0,0,0,0,2,0,0,0,0,1,1,0,0,1,0,0,1},
    {1,0,0,0,0,2,2,0,2,2,2,0,1,0,0,1,0,1,0,0,1,0,0,1},
    {1,0,0,0,0,0,1,8,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,1},
    {1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1},
    {1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1},
    {1,0,0,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1},
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
};

unsigned char new_map[MAP_WIDTH][MAP_HEIGHT];


void map_dump()
{
    for (int y = 0; y < MAP_HEIGHT; y++) {
	printf("{");
	for (int x = 0; x < MAP_WIDTH; x++) {
	    printf("%d, ", map[x][y]);
	}
	printf("}\n");
    }
}

// Cellular Automaton
int map_get_neighbours(int x, int y)
{
    int n = 0;
    for (int dy = -1; dy <= 1; dy++) {
	for (int dx = -1; dx <= 1; dx++) {
	    if (dx == 0 && dy == 0) {
		continue;
	    }
	    int nx = dx + x;
	    int ny = dy + y;
	    if (nx < 0 || ny < 0 || nx >= MAP_WIDTH || ny >= MAP_HEIGHT) {
		n++;
	    } else if (map[nx][ny] == 1) {
		n++;
	    }
	}
    }
    return n;
}

void map_generate()
{
    for (int x = 0; x < MAP_WIDTH; x++) {
	for (int y = 0; y < MAP_HEIGHT; y++) {
	    if (map_get_neighbours(x, y) > 5) {
		new_map[x][y] = 1;
	    } else {
		new_map[x][y] = 0;
	    }
	}
    }
    memcpy(map, new_map, MAP_WIDTH*MAP_HEIGHT);
    map_dump();
}
